# Minecraft Discord Controller

DiscordからMinecraftサーバーを管理するためのBotです。modのアップロード、サーバーの再起動、ステータス確認などの操作をDiscordのスラッシュコマンドで実行できます。

## 機能

- modファイルのアップロードと配置
- サーバーの再起動とmod読み込みの監視
- サーバーステータスの確認
- 最後にアップロードしたmodの確認

## コマンド一覧

### `/uploadmod`

modのjarファイルをアップロードしてサーバーのmodsディレクトリに配置します。

**使い方:**
```
/uploadmod jar:<ファイルを添付>
```

**説明:**
- Forge/Fabricの`.jar`ファイルのみ受け付けます
- ファイルはサーバーの`mods/`ディレクトリにコピーされます
- modのメタデータ（名前とバージョン）を自動で抽出して表示します
- アップロードしたファイル名は記録され、`/restart`コマンドで使用されます

**例:**
```
/uploadmod jar:[my-awesome-mod-1.0.0.jar]
```

### `/restart`

サーバーを再起動し、modの読み込み完了まで監視します。

**使い方:**
```
/restart [watch:true/false]
```

**パラメータ:**
- `watch` (オプション、デフォルト: `true`): 直近にアップロードしたjarファイルを監視のヒントとして使用するかどうか

**説明:**
- サーバーを再起動します（RCONまたはsystemdを使用）
- 再起動後、サーバーの起動とmodの読み込み完了をログで監視します
- 読み込み完了を検知すると、チャンネルに成功メッセージを送信します
- タイムアウトした場合、警告メッセージを送信します

**例:**
```
/restart
/restart watch:true
```

### `/status`

サーバーの現在の状態を表示します。

**使い方:**
```
/status
```

**説明:**
- サーバーのオンライン/オフライン状態を確認します
- サーバーがオンラインの場合、プレイヤー数やバージョン情報などを表示します

**例:**
```
/status
```

### `/lastmod`

最後にアップロードしたmodファイル名を表示します。

**使い方:**
```
/lastmod
```

**説明:**
- このギルドで最後に`/uploadmod`コマンドでアップロードしたjarファイル名を表示します
- まだアップロードがない場合は「（記録なし）」と表示されます

**例:**
```
/lastmod
```

## 使い方の流れ

1. **modをアップロード**
   ```
   /uploadmod jar:[modファイル]
   ```

2. **サーバーを再起動**
   ```
   /restart
   ```
   - Botが自動的にサーバーの起動とmodの読み込みを監視します
   - 完了すると通知が届きます

3. **ステータス確認（オプション）**
   ```
   /status
   ```

## 権限

- `ALLOWED_ROLE_ID`が設定されている場合、指定されたロールを持つユーザーのみがコマンドを実行できます
- `ALLOWED_ROLE_ID`が設定されていない場合、すべてのユーザーがコマンドを実行できます

## 注意事項

- `/uploadmod`でアップロードしたmodは、サーバーを再起動するまで反映されません
- `/restart`コマンドはサーバーの再起動中は一定時間応答がありません（デフォルトで最大240秒）
- modファイルのアップロード記録はBotを再起動するとリセットされます
